title: Green Shift
views:
  # ========== TAB 1: DEVICES ==========
  - title: Devices
    path: devices
    icon: mdi:power-plug
    type: panel
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              # Monitored Devices
              Real-time values from automatically discovered **hardware sensors**.

          # --- GLOBAL OVERVIEW ---
          - type: horizontal-stack
            cards:
              - type: sensor
                entity: sensor.current_consumption
                name: Total Load
                graph: line
              - type: sensor
                entity: sensor.current_hourly_cost
                name: Current Hourly Cost
                graph: line
              - type: sensor
                entity: sensor.daily_cost
                name: Current Daily Cost
                graph: line
              - type: sensor
                entity: sensor.daily_co2_estimate
                name: Current Daily CO2 (kg)
                graph: line

          # --- DYNAMIC AREA DASHBOARD (CLEAN VERSION) ---
          - type: vertical-stack
            cards:
              - type: markdown
                content: "### üè† Area Snapshot"
              
              # The Dropdown Menu
              - type: entities
                entities:
                  - entity: select.dashboard_area_filter
                    name: Filter by Room
                style: |
                  ha-card {
                    box-shadow: none;
                    background: none;
                    margin-bottom: -20px; /* Pulls the table up closer */
                  }

              # The filtered table
              - type: markdown
                content: >
                  {%- set filter = states('select.dashboard_area_filter') -%}
                  {%- set ns = namespace(areas=[]) -%}
                  {%- for cat in ['power', 'energy', 'temperature', 'humidity', 'illuminance', 'occupancy'] -%}
                    {%- set sensors = state_attr('sensor.hardware_sensors', cat) -%}
                    {%- if sensors -%}
                      {%- for s in sensors -%}
                        {%- set area_name = s.get('area') -%}
                        {%- if area_name and area_name != 'No Area' and area_name not in ns.areas -%}
                          {%- set ns.areas = ns.areas + [area_name] -%}
                        {%- endif -%}
                      {%- endfor -%}
                    {%- endif -%}
                  {%- endfor -%}
                  {%- if ns.areas | length == 0 -%}
                  ‚ö†Ô∏è **No areas detected.**
                  {%- endif -%}
                  {%- for area in ns.areas | sort -%}
                    {%- if filter in ['All Areas', 'unknown', 'unavailable'] or filter == area -%}
                      <h3>{{ area }}</h3>
                      <table width="100%">
                      {%- for cat in ['power', 'energy', 'temperature', 'humidity', 'illuminance', 'occupancy'] -%}
                        {%- set sensors = state_attr('sensor.hardware_sensors', cat) -%}
                        {%- if sensors -%}
                          {%- for s in sensors -%}
                            {%- if s.get('area') == area -%}
                              <tr>
                                <td width="5%" style="text-align: center;">
                                  <ha-icon icon="{{ 'mdi:lightning-bolt' if cat == 'power' else 'mdi:counter' if cat == 'energy' else 'mdi:thermometer' if cat == 'temperature' else 'mdi:water-percent' if cat == 'humidity' else 'mdi:brightness-5' if cat == 'illuminance' else 'mdi:eye' }}" style="width: 20px; color: var(--secondary-text-color);"></ha-icon>
                                </td>
                                <td style="text-align: left;">{{ s.name }}</td>
                                <td style="text-align: right;">
                                  {%- if cat == 'occupancy' -%}
                                    {{ 'üî¥' if s.value == 'on' else 'üü¢' }}
                                  {%- else -%}
                                    <b>{{ s.value }}</b> <small>{{ s.unit }}</small>
                                  {%- endif -%}
                                </td>
                              </tr>
                            {%- endif -%}
                          {%- endfor -%}
                        {%- endif -%}
                      {%- endfor -%}
                      </table>
                    {%- endif -%}
                  {%- endfor -%}

  # ========== TAB 2: DASHBOARD ==========
  - title: Dashboard
    path: dashboard
    icon: mdi:chart-line
    type: panel
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              # Dashboard 
              Analyze your energy consumption patterns and identify opportunities for savings.
          - type: conditional
            conditions:
              - entity: sensor.research_phase
                state: baseline
            card:
              type: markdown
              content: |
                ## Calibration Mode
                The system is learning your consumption patterns.
                **{{ state_attr('sensor.research_phase', 'days_remaining') }} days remaining**     

          - type: history-graph
            title: Consumption vs Baseline (Last Week)
            hours_to_show: 168
            entities:
              - entity: sensor.current_consumption
                name: Current Consumption
              - entity: sensor.energy_baseline
                name: Baseline

          - type: glance
            title: Weekly Summary
            entities:
              - entity: sensor.current_consumption
              - entity: sensor.energy_baseline
              - entity: sensor.savings_accumulated

  # ========== TAB 3: CHALLENGES ==========
  - title: Challenges
    path: tasks
    icon: mdi:clipboard-check
    type: panel
    visible:
      - condition: state
        entity: sensor.research_phase
        state: active
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              # Daily Challenges
              Complete today's random tasks to improve your energy efficiency!
          - type: markdown
            content: |
              {% set tasks = state_attr('sensor.daily_tasks', 'tasks') %}
              {% if tasks %}
                {% for task in tasks %}
                - **{{ task.title }}**
                  *{{ task.description }}*
                {% endfor %}
              {% else %}
                No tasks available yet.
              {% endif %}

  # ========== TAB 4: COLLABORATIVE GOAL ==========
  - title: Collaborative Goal
    path: collaborative
    icon: mdi:account-group
    type: panel
    visible:
      - condition: state
        entity: sensor.research_phase
        state: active
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: "# Weekly Challenge\nReduce consumption to 85% of your baseline."
          - type: gauge
            entity: sensor.weekly_challenge
            name: Weekly Target Progress
            min: 0
            max: 100
            severity:
              green: 0
              yellow: 85
              red: 100
          - type: entities
            title: Challenge Details
            entities:
              - entity: sensor.weekly_challenge
          - type: markdown
            content: |
              **Current Average**: {{ state_attr('sensor.weekly_challenge', 'current_avg_w') }} kW  
              **Target Average**: {{ state_attr('sensor.weekly_challenge', 'target_avg_w') }} kW  
              **Baseline**: {{ state_attr('sensor.weekly_challenge', 'baseline_w') }} kW

  # ========== TAB 5: USER PROFILE ==========
  - title: Profile
    path: profile
    icon: mdi:account-circle
    type: panel
    cards:
      - type: vertical-stack
        cards:
          - type: conditional
            conditions:
              - entity: sensor.research_phase
                state: baseline
            card:
              type: markdown
              content: |
                ## Profile Under Construction
                **Calibration Mode**: {{ state_attr('sensor.research_phase', 'days_remaining') }} days remaining

          - type: glance
            title: Total Impact
            entities:
              - entity: sensor.savings_accumulated
              - entity: sensor.co2_saved
              - entity: sensor.tasks_completed

          - type: entities
            title: Engagement Metrics
            entities:
              - entity: sensor.behaviour_index
              - entity: sensor.fatigue_index

          - type: gauge
            entity: sensor.collaborative_goal_progress
            name: Weekly Target
            min: 0
            max: 100
            severity:
              green: 0
              yellow: 85
              red: 100

  # ========== TAB 6: SETTINGS ==========
  - title: Settings
    path: settings
    icon: mdi:cog
    type: panel
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: "# System Settings"
          - type: entities
            title: Goals and Preferences
            entities:
              - entity: input_number.energy_saving_target
              - entity: input_select.currency
              - entity: input_number.electricity_price
          - type: entities
            title: Status
            entities:
              - entity: sensor.research_phase
              - entity: sensor.energy_baseline
              - entity: sensor.behaviour_index