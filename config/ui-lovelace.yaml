title: Green Shift
views:
  # ========== TAB 1: DEVICES ==========
  - title: Devices
    path: devices
    icon: mdi:power-plug
    type: panel
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              # Monitored Devices
              Real-time values from automatically discovered **hardware sensors**.

          - type: horizontal-stack
            cards:
              - type: sensor
                entity: sensor.current_consumption
                name: Total Load
                graph: line
              - type: sensor
                entity: sensor.current_hourly_cost
                name: Current Hourly Cost
                graph: line

          - type: grid
            title: âš¡ Live Power
            columns: 1
            square: false
            cards:
              - type: markdown
                content: |
                  {% set sensors = state_attr('sensor.hardware_sensors', 'power') %}
                  {% if sensors -%}
                  | Device | Usage |
                  |:--- | ---:|
                  {%- for s in sensors %}
                  | <ha-icon icon="mdi:lightning-bolt" style="color:var(--energy-grid-consumption-color)"></ha-icon> **{{ s.name }}** | `{{ s.value }} {{ s.unit }}` |
                  {%- endfor %}
                  | **Total Current Load** | **{{ states('sensor.current_consumption') }} kW** |
                  {%- else %}
                  *No power sensors detected.*
                  {%- endif %}

          - type: grid
            title: ðŸ“Š Cumulative Energy
            columns: 1
            square: false
            cards:
              - type: markdown
                content: |
                  <table width="100%">
                  {% set e_sensors = state_attr('sensor.hardware_sensors', 'energy') %}
                  {% if e_sensors -%}
                    {%- for s in e_sensors %}
                    <tr>
                      <td><ha-icon icon="mdi:counter" style="color:var(--secondary-text-color)"></ha-icon> {{ s.name }}</td>
                      <td align="right"><b>{{ s.value }}</b> <small>{{ s.unit }}</small></td>
                    </tr>
                    {%- endfor %}
                  {%- else -%}
                    <tr><td><i>No energy meters discovered</i></td></tr>
                  {%- endif %}
                  </table>

          - type: vertical-stack
            title: ðŸŒ¡ Environment & Climate
            cards:
              - type: markdown
                content: |
                  ### Temperature
                  {% set sensors = state_attr('sensor.hardware_sensors', 'temperature') %}
                  {% if sensors -%}
                  {% for s in sensors -%}
                  **{{ s.name }}**: {{ s.value }}{{ s.unit }}  
                  {% endfor %}
                  {%- else -%}
                  _None_
                  {%- endif %}
                  ---
                  ### Humidity
                  {% set sensors = state_attr('sensor.hardware_sensors', 'humidity') %}
                  {% if sensors -%}
                  {% for s in sensors -%}
                  **{{ s.name }}**: {{ s.value }}{{ s.unit }}  
                  {% endfor %}
                  {%- else -%}
                  _None_
                  {%- endif %}

          - type: grid
            columns: 2
            square: false
            cards:
              - type: markdown
                title: ðŸ’¡ Light Level
                content: |
                  {% set sensors = state_attr('sensor.hardware_sensors', 'illuminance') %}
                  {% if sensors -%}
                  {% for s in sensors -%} â€¢ {{ s.name }}: **{{ s.value }} lx** {% endfor %}
                  {%- else -%} _Dark_ {%- endif %}
              - type: markdown
                title: ðŸ‘€ Occupancy
                content: |
                  {% set sensors = state_attr('sensor.hardware_sensors', 'occupancy') %}
                  {% if sensors -%}
                  {% for s in sensors -%} **{{ s.name }}**: {{ 'ðŸ”´ Occupied' if s.value == 'on' else 'ðŸŸ¢ Clear' }} {% endfor %}
                  {%- else -%} _No data_ {%- endif %}

  # ========== TAB 2: DASHBOARD ==========
  - title: Dashboard
    path: dashboard
    icon: mdi:chart-line
    type: panel
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              # Dashboard 
              Analyze your energy consumption patterns and identify opportunities for savings.
          - type: conditional
            conditions:
              - entity: sensor.research_phase
                state: baseline
            card:
              type: markdown
              content: |
                ## Calibration Mode
                The system is learning your consumption patterns.
                **{{ state_attr('sensor.research_phase', 'days_remaining') }} days remaining**     

          - type: history-graph
            title: Consumption vs Baseline (Last Week)
            hours_to_show: 168
            entities:
              - entity: sensor.current_consumption
                name: Current Consumption
              - entity: sensor.energy_baseline
                name: Baseline

          - type: glance
            title: Weekly Summary
            entities:
              - entity: sensor.current_consumption
              - entity: sensor.energy_baseline
              - entity: sensor.savings_accumulated

  # ========== TAB 3: CHALLENGES ==========
  - title: Challenges
    path: tasks
    icon: mdi:clipboard-check
    type: panel
    visible:
      - condition: state
        entity: sensor.research_phase
        state: active
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              # Daily Challenges
              Complete today's random tasks to improve your energy efficiency!
          - type: markdown
            content: |
              {% set tasks = state_attr('sensor.daily_tasks', 'tasks') %}
              {% if tasks %}
                {% for task in tasks %}
                - **{{ task.title }}**
                  *{{ task.description }}*
                {% endfor %}
              {% else %}
                No tasks available yet.
              {% endif %}

  # ========== TAB 4: COLLABORATIVE GOAL ==========
  - title: Collaborative Goal
    path: collaborative
    icon: mdi:account-group
    type: panel
    visible:
      - condition: state
        entity: sensor.research_phase
        state: active
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: "# Weekly Challenge\nReduce consumption to 85% of your baseline."
          - type: gauge
            entity: sensor.weekly_challenge
            name: Weekly Target Progress
            min: 0
            max: 100
            severity:
              green: 0
              yellow: 85
              red: 100
          - type: entities
            title: Challenge Details
            entities:
              - entity: sensor.weekly_challenge
          - type: markdown
            content: |
              **Current Average**: {{ state_attr('sensor.weekly_challenge', 'current_avg_w') }} kW  
              **Target Average**: {{ state_attr('sensor.weekly_challenge', 'target_avg_w') }} kW  
              **Baseline**: {{ state_attr('sensor.weekly_challenge', 'baseline_w') }} kW

  # ========== TAB 5: USER PROFILE ==========
  - title: Profile
    path: profile
    icon: mdi:account-circle
    type: panel
    cards:
      - type: vertical-stack
        cards:
          - type: conditional
            conditions:
              - entity: sensor.research_phase
                state: baseline
            card:
              type: markdown
              content: |
                ## Profile Under Construction
                **Calibration Mode**: {{ state_attr('sensor.research_phase', 'days_remaining') }} days remaining

          - type: glance
            title: Total Impact
            entities:
              - entity: sensor.savings_accumulated
              - entity: sensor.co2_saved
              - entity: sensor.tasks_completed

          - type: entities
            title: Engagement Metrics
            entities:
              - entity: sensor.behaviour_index
              - entity: sensor.fatigue_index

          - type: gauge
            entity: sensor.collaborative_goal_progress
            name: Weekly Target
            min: 0
            max: 100
            severity:
              green: 0
              yellow: 85
              red: 100

  # ========== TAB 6: SETTINGS ==========
  - title: Settings
    path: settings
    icon: mdi:cog
    type: panel
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: "# System Settings"
          - type: entities
            title: Goals and Preferences
            entities:
              - entity: input_number.energy_saving_target
              - entity: input_select.currency
              - entity: input_number.electricity_price
          - type: entities
            title: Status
            entities:
              - entity: sensor.research_phase
              - entity: sensor.energy_baseline
              - entity: sensor.behaviour_index