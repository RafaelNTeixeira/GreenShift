title: Green Shift
views:
  # ========== TAB 1: DEVICES (Always Visible) ==========
  - title: Devices
    path: devices
    icon: mdi:power-plug
    badges: []
    cards:
      - type: markdown
        content: |
          # Monitored Devices
          Real-time consumption of each automatically discovered smart plug.
      
      # Dynamic card: repeats for each power sensor
      - type: entities
        title: Consumption by Device
        entities:
          - entity: sensor.current_consumption
            name: Total Consumption
            icon: mdi:lightning-bolt
      
      # Placeholder for auto-discovered sensors
      - type: markdown
        content: |
          **Note**: Devices are automatically discovered by Green Shift.
          Access the Entity Registry to see all active sensors.

  # ========== TAB 2: DASHBOARD (Always Visible) ==========
  - title: Dashboard
    path: dashboard
    icon: mdi:chart-line
    badges: []
    cards:
      # Calibration banner (visible only during baseline)
      - type: conditional
        conditions:
          - entity: sensor.research_phase
            state: baseline
        card:
          type: markdown
          content: |
            ## Calibration Mode
            The system is learning your consumption patterns.
            **{{ state_attr('sensor.research_phase', 'days_remaining') }} days remaining**
            
            During this period, you will not receive notifications or challenges.
      
      # Graph: Current Consumption vs Baseline
      - type: history-graph
        title: Consumption vs Baseline (Last Week)
        hours_to_show: 168
        entities:
          - entity: sensor.current_consumption
            name: Current Consumption
          - entity: sensor.energy_baseline
            name: Baseline

      # Summary statistics
      - type: glance
        title: Weekly Summary
        entities:
          - entity: sensor.current_consumption
            name: Current Consumption
            icon: mdi:lightning-bolt
          - entity: sensor.energy_baseline
            name: Baseline
            icon: mdi:chart-line
          - entity: sensor.savings_accumulated
            name: Savings
            icon: mdi:currency-eur

  # ========== TAB 3: USER PROFILE (Always Visible) ==========
  - title: Profile
    path: profile
    icon: mdi:account-circle
    badges: []
    cards:
      # Calibration banner
      - type: conditional
        conditions:
          - entity: sensor.research_phase
            state: baseline
        card:
          type: markdown
          content: |
            ## Profile Under Construction
            **Calibration Mode**: {{ state_attr('sensor.research_phase', 'days_remaining') }} days remaining
            
            Your profile will be available after the initial phase.

      # Accumulated statistics
      - type: glance
        title: Total Impact
        entities:
          - entity: sensor.savings_accumulated
            name: Savings
            icon: mdi:currency-eur
          - entity: sensor.co2_saved
            name: CO2 Avoided
            icon: mdi:leaf
          - entity: sensor.tasks_completed
            name: Tasks
            icon: mdi:check-circle

      # Behavior indices
      - type: entities
        title: Engagement Metrics
        entities:
          - entity: sensor.behaviour_index
            name: Adherence Index
            icon: mdi:thumb-up
          - entity: sensor.fatigue_index
            name: Fatigue Index
            icon: mdi:alert-circle

      # Weekly progress
      - type: gauge
        entity: sensor.collaborative_goal_progress
        name: Weekly Target
        min: 0
        max: 100
        severity:
          green: 0
          yellow: 85
          red: 100

  # ========== TAB 4: SETTINGS (Always Visible) ==========
  - title: Settings
    path: settings
    icon: mdi:cog
    badges: []
    cards:
      - type: markdown
        content: |
          # System Settings

      - type: entities
        title: Goals and Preferences
        entities:
          - entity: input_number.energy_saving_target
            name: Savings Target (%)
          - entity: input_select.currency
            name: Currency
          - entity: input_number.electricity_price
            name: Electricity Price (â‚¬/kWh)
          - entity: input_boolean.enable_notifications
            name: Enable Notifications

      - type: markdown
        content: |
          ## System Status
      
      - type: entities
        title: Status
        entities:
          - entity: sensor.research_phase
            name: Operating Phase
          - entity: sensor.energy_baseline
            name: Learned Baseline
          - entity: sensor.behaviour_index
            name: Behaviour Index

  # ========== TAB 5: CHALLENGES (Locked until active phase) ==========
  - title: Challenges
    path: tasks
    icon: mdi:clipboard-check
    badges: []
    # Conditional visibility: only if phase == active
    visible:
      - condition: state
        entity: sensor.research_phase
        state: active
    cards:
      - type: markdown
        content: |
          # Daily Challenges
          Complete today's random tasks to improve your energy efficiency!

      # Daily tasks from backend
      - type: custom:auto-entities
        card:
          type: entities
          title: "Today's Tasks ({{ state_attr('sensor.daily_tasks', 'tasks') | length }})"
        entities:
          - entity_id: sensor.daily_tasks
            name: Daily Tasks

      # Render tasks as markdown
      - type: markdown
        content: |
          {% set tasks = state_attr('sensor.daily_tasks', 'tasks') %}
          {% if tasks %}
            {% for task in tasks %}
          - **{{ task.title }}**
            *{{ task.description }}*
            
            {% endfor %}
          {% else %}
            No tasks available yet. Check available sensors.
          {% endif %}

  # ========== TAB 6: COLLABORATIVE GOAL (Locked until active phase) ==========
  - title: Collaborative Goal
    path: collaborative
    icon: mdi:account-group
    badges: []
    visible:
      - condition: state
        entity: sensor.research_phase
        state: active
    cards:
      - type: markdown
        content: |
          # Weekly Challenge
          Reduce your energy consumption to 85% of your baseline (15% reduction goal).

      # Weekly challenge progress gauge
      - type: gauge
        entity: sensor.weekly_challenge
        name: Weekly Target Progress
        min: 0
        max: 100
        severity:
          green: 0
          yellow: 85
          red: 100
        needle: true

      # Challenge details
      - type: entities
        title: Challenge Details
        entities:
          - entity: sensor.weekly_challenge
            name: Progress to Target
            format: "{{ state }}%"
      
      - type: markdown
        content: |
          {% set challenge = state_attr('sensor.weekly_challenge', '__dict__') %}
          **Current Average**: {{ state_attr('sensor.weekly_challenge', 'current_avg_w') }} W
          
          **Target Average**: {{ state_attr('sensor.weekly_challenge', 'target_avg_w') }} W
          
          **Baseline**: {{ state_attr('sensor.weekly_challenge', 'baseline_w') }} W
          
          **Status**: 
          {% if state_attr('sensor.weekly_challenge', 'status') == 'completed' %}
            **Challenge Completed!** Your consumption is below the target.
          {% else %}
            **In Progress** - Keep working towards the goal!
          {% endif %}