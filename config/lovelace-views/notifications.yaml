# ========== TAB 5: NOTIFICATIONS ==========
title: Notifications
path: notifications
icon: mdi:bell
type: panel
cards:
  - type: vertical-stack
    cards:
      
      # --- TOP SECTION (STATS & INSTRUCTIONS) ---
      - type: tile
        entity: sensor.active_notifications
        name: üîî Active Alerts
        icon: mdi:bell-ring
        color: accent

      - type: markdown
        content: |
          ### ‚ÑπÔ∏è How to Use
          1. **üìñ Read** the alerts below.
          2. **üîΩ Select** the ID in the action panel.
          3. **üëÜ Tap** Accept or Reject.

      # --- INBOX SECTION ---
      - type: markdown
        title: üì¨ Pending Inbox
        content: |
          {%- set notifs = state_attr('sensor.active_notifications', 'notifications') -%}
          {%- set safe_notifs = notifs if notifs else [] -%}
          {%- set pending = safe_notifs | selectattr('responded', 'equalto', false) | list -%}
          
          {%- if pending | length == 0 -%}
          ### ‚úÖ All Caught Up!
          No pending alerts at the moment. üòé
          {%- else -%}
          
          {%- for n in pending -%}
          ---
          ### üì¢ {{ n.title }}
          **ID:** `{{ n.notification_id }}` ‚Ä¢ **‚è∞ Time:** *{{ n.time_ago }}*
          
          {{ n.message }}
          
          {%- endfor -%}
          {%- endif -%}

      # --- ACTION PANEL ---
      - type: vertical-stack
        cards:
          - type: entities
            title: üé¨ Take Action
            show_header_toggle: false
            entities:
              - entity: select.notification_selector
                name: üîΩ Select ID to Respond

          - type: horizontal-stack
            cards:
              - type: tile
                entity: select.notification_selector
                name: Accept
                icon: mdi:check
                color: green
                show_entity_picture: false
                state_content: []
                tap_action:
                  action: call-service
                  service: green_shift.respond_to_selection
                  data:
                    decision: accept
              
              - type: tile
                entity: select.notification_selector
                name: Reject
                icon: mdi:close
                color: red
                show_entity_picture: false
                state_content: []
                tap_action:
                  action: call-service
                  service: green_shift.respond_to_selection
                  data:
                    decision: reject

      # --- HISTORY TABLE ---
      - type: markdown
        title: üìú History
        content: |
          {%- set ns = state_attr('sensor.active_notifications', 'notifications') -%}
          {%- if ns -%}
          <table width="100%">
            <thead>
              <tr>
                <th align="left">‚è∞ Time</th>
                <th align="left">üìã Type</th>
                <th align="center">üìä Status</th>
              </tr>
            </thead>
            <tbody>
            {%- for n in ns[:8] -%}
              <tr>
                <td>{{ n.time_ago }}</td>
                <td>{{ n.action_type | replace('_', ' ') | capitalize }}</td>
                <td align="center">{{ n.status_emoji }}</td>
              </tr>
            {%- endfor -%}
            </tbody>
          </table>
          {%- else -%}
          üì≠ No history available.
          {%- endif -%}