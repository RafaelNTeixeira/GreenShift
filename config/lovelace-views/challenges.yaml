# ========== CHALLENGES TAB ==========
title: Challenges
path: tasks
icon: mdi:clipboard-check
type: panel
cards:
  - type: vertical-stack
    cards:
      - type: conditional
        conditions:
          - entity: sensor.research_phase
            state: baseline
        card:
          type: markdown
          content: |
            ## üîí Challenges Locked
            **{{ state_attr('sensor.research_phase', 'days_remaining') }} days** until unlock ‚è≥

      - type: conditional
        conditions:
          - entity: sensor.research_phase
            state: active
        card:
          type: vertical-stack
          cards:
            - type: markdown
              content: |
                # üìÖ Daily Energy Challenges
                {% set verified = state_attr('sensor.daily_tasks', 'verified_count') | default(0) %}
                {% set total = state_attr('sensor.daily_tasks', 'total_count') | default(0) %}
                {% if total > 0 %}
                ‚úÖ **{{ verified }}/{{ total }}** tasks verified today
                {% else %}
                üì≠ No tasks available for today.
                {% endif %}

            # Task 1 Card - Only show if at least 1 task exists
            - type: conditional
              conditions:
                - condition: numeric_state
                  entity: sensor.daily_tasks
                  attribute: total_count
                  above: 0
              card:
                type: vertical-stack
                cards:
                  - type: horizontal-stack
                    cards:
                      - type: markdown
                        content: |
                          {% set tasks = state_attr('sensor.daily_tasks', 'tasks') %}
                          {% if tasks and tasks | length > 0 %}
                          {% set t = tasks[0] %}
                          
                          ### {{ t.status_emoji }} Task 1: {{ t.title }}
                          
                          {{ t.description }}
                          
                          **üéØ Target:** {{ t.target_value }}{{ t.target_unit }} (from {{ t.baseline_value }}{{ t.target_unit }})  
                          **üìä Difficulty:** {{ t.difficulty_display }}  
                          {% if t.area_name %}**üìç Area:** {{ t.area_name }}{% endif %}
                          
                          {% if t.verified %}
                          ‚úÖ **VERIFIED!** You achieved the target!
                          {% else %}
                          üéØ **Active** - Complete this today!
                          {% endif %}
                          {% endif %}

                  - type: horizontal-stack
                    cards:  
                      - type: button
                        name: Too Easy
                        icon: mdi:emoticon-happy-outline
                        icon_height: 30px
                        tap_action:
                          action: call-service
                          service: green_shift.submit_task_feedback
                          data:
                            task_index: 0
                            feedback: too_easy
                        entity: sensor.daily_tasks
                        show_state: false
                      
                      - type: button
                        name: Just Right
                        icon: mdi:emoticon-neutral-outline
                        icon_height: 30px
                        tap_action:
                          action: call-service
                          service: green_shift.submit_task_feedback
                          data:
                            task_index: 0
                            feedback: just_right
                        entity: sensor.daily_tasks
                        show_state: false
                      
                      - type: button
                        name: Too Hard
                        icon: mdi:emoticon-sad-outline
                        icon_height: 30px
                        tap_action:
                          action: call-service
                          service: green_shift.submit_task_feedback
                          data:
                            task_index: 0
                            feedback: too_hard
                        entity: sensor.daily_tasks
                        show_state: false

            # Task 2 Card - Only show if at least 2 tasks exist
            - type: conditional
              conditions:
                - condition: numeric_state
                  entity: sensor.daily_tasks
                  attribute: total_count
                  above: 1
              card:
                type: vertical-stack
                cards:
                  - type: horizontal-stack
                    cards:
                      - type: markdown
                        content: |
                          {% set tasks = state_attr('sensor.daily_tasks', 'tasks') %}
                          {% if tasks and tasks | length > 1 %}
                          {% set t = tasks[1] %}

                          ---

                          ### {{ t.status_emoji }} Task 2: {{ t.title }}
                          
                          {{ t.description }}
                          
                          **üéØ Target:** {{ t.target_value }}{{ t.target_unit }} (from {{ t.baseline_value }}{{ t.target_unit }})  
                          **üìä Difficulty:** {{ t.difficulty_display }}  
                          {% if t.area_name %}**üìç Area:** {{ t.area_name }}{% endif %}
                          
                          {% if t.verified %}
                          ‚úÖ **VERIFIED!** You achieved the target!
                          {% else %}
                          üéØ **Active** - Complete this today!
                          {% endif %}
                          {% endif %}

                  - type: horizontal-stack
                    cards:
                      - type: button
                        name: Too Easy
                        icon: mdi:emoticon-happy-outline
                        icon_height: 30px
                        tap_action:
                          action: call-service
                          service: green_shift.submit_task_feedback
                          data:
                            task_index: 1
                            feedback: too_easy
                        entity: sensor.daily_tasks
                        show_state: false
                      
                      - type: button
                        name: Just Right
                        icon: mdi:emoticon-neutral-outline
                        icon_height: 30px
                        tap_action:
                          action: call-service
                          service: green_shift.submit_task_feedback
                          data:
                            task_index: 1
                            feedback: just_right
                        entity: sensor.daily_tasks
                        show_state: false
                      
                      - type: button
                        name: Too Hard
                        icon: mdi:emoticon-sad-outline
                        icon_height: 30px
                        tap_action:
                          action: call-service
                          service: green_shift.submit_task_feedback
                          data:
                            task_index: 1
                            feedback: too_hard
                        entity: sensor.daily_tasks
                        show_state: false

            # Task 3 Card - Only show if 3 tasks exist
            - type: conditional
              conditions:
                - condition: numeric_state
                  entity: sensor.daily_tasks
                  attribute: total_count
                  above: 2
              card:
                type: vertical-stack
                cards:
                  - type: horizontal-stack
                    cards:
                      - type: markdown
                        content: |
                          {% set tasks = state_attr('sensor.daily_tasks', 'tasks') %}
                          {% if tasks and tasks | length > 2 %}
                          {% set t = tasks[2] %}

                          ---

                          ### {{ t.status_emoji }} Task 3: {{ t.title }}
                          
                          {{ t.description }}
                          
                          **üéØ Target:** {{ t.target_value }}{{ t.target_unit }} (from {{ t.baseline_value }}{{ t.target_unit }})  
                          **üìä Difficulty:** {{ t.difficulty_display }}  
                          {% if t.area_name %}**üìç Area:** {{ t.area_name }}{% endif %}
                          
                          {% if t.verified %}
                          ‚úÖ **VERIFIED!** You achieved the target!
                          {% else %}
                          üéØ **Active** - Complete this today!
                          {% endif %}
                          {% endif %}

                  - type: horizontal-stack
                    cards:
                      - type: button
                        name: Too Easy
                        icon: mdi:emoticon-happy-outline
                        icon_height: 30px
                        tap_action:
                          action: call-service
                          service: green_shift.submit_task_feedback
                          data:
                            task_index: 2
                            feedback: too_easy
                        entity: sensor.daily_tasks
                        show_state: false
                      
                      - type: button
                        name: Just Right
                        icon: mdi:emoticon-neutral-outline
                        icon_height: 30px
                        tap_action:
                          action: call-service
                          service: green_shift.submit_task_feedback
                          data:
                            task_index: 2
                            feedback: just_right
                        entity: sensor.daily_tasks
                        show_state: false
                      
                      - type: button
                        name: Too Hard
                        icon: mdi:emoticon-sad-outline
                        icon_height: 30px
                        tap_action:
                          action: call-service
                          service: green_shift.submit_task_feedback
                          data:
                            task_index: 2
                            feedback: too_hard
                        entity: sensor.daily_tasks
                        show_state: false

            # Verify All Tasks Button - Only show if tasks exist
            - type: conditional
              conditions:
                - condition: numeric_state
                  entity: sensor.daily_tasks
                  attribute: total_count
                  above: 0
              card:
                type: button
                name: "Verify All Tasks"
                icon: mdi:check-circle
                icon_height: 20px
                tap_action:
                  action: call-service
                  service: green_shift.verify_tasks
                show_state: false

            # Summary - Only show if tasks exist
            - type: conditional
              conditions:
                - condition: numeric_state
                  entity: sensor.daily_tasks
                  attribute: total_count
                  above: 0
              card:
                type: markdown
                content: |
                  ---
                  ### üí° How Feedback Works
                  
                  Rate each task's difficulty to help the system adjust future challenges:
                  - **üòä Too Easy** ‚Üí Next time will be harder
                  - **üòê Just Right** ‚Üí Difficulty stays the same
                  - **üò∞ Too Hard** ‚Üí Next time will be easier
                  
                  ‚è±Ô∏è Tasks are verified every 15 minutes, but you can also manually trigger verification by clicking on the "Verify All Tasks" button to see if you've completed any tasks and get real-time feedback on your progress!
